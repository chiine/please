<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layouts/layout1}">
	



<th:block layout:fragment="script">
	

    <script th:inline="javascript">
        $(document).ready(function(){
            var errorMessage = [[${errorMessage}]];
            if(errorMessage != null){
                alert(errorMessage);
            }

            bindDomEvent();

        });

        function bindDomEvent(){
            $(".custom-file-input").on("change", function() {
                var fileName = $(this).val().split("\\").pop();  //이미지 파일명
                var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
                fileExt = fileExt.toLowerCase(); //소문자 변환

                if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
                    alert("이미지 파일만 등록이 가능합니다.");
                    return;
                }

                $(this).siblings(".custom-file-label").html(fileName);
            });
        }

    </script>

</th:block>


<div layout:fragment="content">
	<form role="form" method="post" enctype="multipart/form-data" th:object="${dogFormDto}">
		
		<input type="hidden" th:field="*{id}">
	
		<div class="form-group">
			<label th:for="name">강아지 주인</label>
			<input type="text" th:field="*{member_id}" class="form-control" placeholder="이름을 입력하세요">
 		</div>
		
		<div class="form-group">
			<select th:field="*{myType}" class="custom-select">
				 <option value="MEETING">만남</option>
				 <option value="BOAST">자랑</option>
			 </select>
		 </div>
		 
		<div class="form-group">
			<label th:for="name">강아지 이름</label>
			<input type="text" th:field="*{name}" class="form-control" placeholder="이름을 입력하세요">
 		</div>
 		<p th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="fieldError">Incorrect data</p>
 		 		
 		<div class="form-group">
			<label th:for="age">강아지 나이</label>
			<input type="text" th:field="*{age}" class="form-control" placeholder="나이를 입력하세요">
 	 	</div>
 	 	<p th:if="${#fields.hasErrors('age')}"
 					th:errors="*{age}" class="fieldError">Incorrect data</p>
 		
 		<div class="form-group">
			<label th:for="type">강아지 품종</label>
			<input type="text" th:field="*{dogType}" class="form-control" placeholder="품종을 입력하세요">
 		</div>
 		<p th:if="${#fields.hasErrors('dogType')}"
 					th:errors="*{dogType}" class="fieldError">Incorrect data</p>
 		
 		<div class="form-group">
			 <lael th:for="gender">강아지 성별</lael>
			 <select th:field="*{gender}" class="custom-select">
				 <option value="MALE">남자</option>
				 <option value="FEMALE">여자</option>
			 </select>
		 </div>
		 
 		
 		<div class="form-group">
			<label th:for="content">강아지 자랑</label>
			<textarea th:field="*{content}" class="form-control"></textarea>
 		</div>
 		
 	 <div th:if="${#lists.isEmpty(dogFormDto.dogImgDtoList)}">
            <div class="form-group" th:each="num: ${#numbers.sequence(1,1)}"> 
                <div class="custom-file img-div">
                    <input type="file" class="custom-file-input" name="dogImgFile">
                    <label class="custom-file-label" th:text="상품이미지 + ${num}"></label> <!-- 몇번째 상품 이미지인지 출력 -->
                </div>
            </div>
        </div>

        <!-- 상품 이미지 정보를 담고 있는 리스트가 비어 있으면은 상품을 수정할 수 있게 밑의 코드가 출력됨 -->
        <div th:if = "${not #lists.isEmpty(dogFormDto.dogImgDtoList)}">
            <div class="form-group" th:each="dogImgDto, status: ${dogFormDto.dogImgDtoList}">
                <div class="custom-file img-div">
                    <input type="file" class="custom-file-input" name="dogImgFile">
                    <input type="hidden" name="dogImgIds" th:value="${dogImgDto.id}">
                    <label class="custom-file-label" th:text="${not #strings.isEmpty(dogImgDto.oriImgName)} ? ${dogImgDto.oriImgName} : '상품이미지' + ${status.index+1}"></label>
                </div>
            </div>
        </div>

		

 		
		<div th:if="${#strings.isEmpty(dogFormDto.id)}" style="text-align:center">
		<button th:formaction="@{/Dboard/new}"  type="submit" class="btn btn-primary">등록</button>
		<button type="button" class="btn btn-primary" onClick="location.href='http://localhost:8505/Dboard/list'">목록</button>
		</div>
		
		<div th:unless="${#strings.isEmpty(dogFormDto.id)}" style="text-align:center">
		<button th:formaction="@{'/Dboard/modify/' + ${dogFormDto.id}}"  type="submit" class="btn btn-primary">수정</button>
		<button type="button" class="btn btn-primary" onClick="location.href='http://localhost:8505/Dboard/list'">목록</button>
		</div>
		
		
	
		
		<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
		
	</form>
	
</div>